<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game ƒêo√°n M√†u N√¢ng Cao</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">üé® Game ƒêo√°n M√†u</h1>
            <div class="game-info">
                <div class="score-board">
                    <span class="score">ƒêi·ªÉm: <span id="score">0</span></span>
                    <span class="high-score">K·ª∑ l·ª•c: <span id="highScore">0</span></span>
                </div>
                <div class="level-info">
                    <span class="level">Level: <span id="level">1</span></span>
                    <span class="lives">M·∫°ng: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
                </div>
            </div>
        </header>

        <div class="main-content">
        <main class="game-area">
            <div class="difficulty-selector">
                <label>ƒê·ªô kh√≥:</label>
                <select id="difficulty">
                    <option value="easy">D·ªÖ (3 m√†u)</option>
                    <option value="medium" selected>Trung b√¨nh (6 m√†u)</option>
                    <option value="hard">Kh√≥ (9 m√†u)</option>
                </select>
            </div>

            <div class="target-color-section">
                <h2>T√¨m m√†u n√†y:</h2>
                <div class="target-color" id="targetColor"></div>
                <div class="color-code" id="colorCode">RGB(?, ?, ?)</div>
                <div class="timer-container">
                    <div class="timer-bar">
                        <div class="timer-fill" id="timerFill"></div>
                    </div>
                    <span class="timer-text" id="timerText">30s</span>
                </div>
            </div>

            <div class="color-options" id="colorOptions">
                <!-- Color buttons will be generated here -->
            </div>

            <div class="game-controls">
                <button class="btn btn-primary" id="newGameBtn">Game M·ªõi</button>
                <button class="btn btn-secondary" id="hintBtn">G·ª£i √Ω (5 ƒëi·ªÉm)</button>
                <button class="btn btn-secondary" id="pauseBtn">T·∫°m d·ª´ng</button>
            </div>

            <div class="combo-counter" id="comboCounter" style="display: none;">
                <span class="combo-text">COMBO x<span id="comboValue">1</span></span>
            </div>
        </main>

            <aside class="side-panel">
                <div class="stats-panel" id="statsPanel">
                    <h3>Th·ªëng k√™</h3>
                    <div class="stat-item">
                        <span>T·ªïng s·ªë game ƒë√£ ch∆°i:</span>
                        <span id="totalGames">0</span>
                    </div>
                    <div class="stat-item">
                        <span>T·ª∑ l·ªá ch√≠nh x√°c:</span>
                        <span id="accuracy">0%</span>
                    </div>
                    <div class="stat-item">
                        <span>Combo cao nh·∫•t:</span>
                        <span id="bestCombo">0</span>
                    </div>
                    <button class="btn btn-danger" id="resetStatsBtn">Reset Th·ªëng k√™</button>
                </div>
                <footer class="footer">
                    <button class="btn btn-info" id="statsBtn">Th·ªëng k√™</button>
                    <button class="btn btn-info" id="rulesBtn">H∆∞·ªõng d·∫´n</button>
                </footer>
            </aside>
        </div>

        <div class="game-over-modal" id="gameOverModal">
            <div class="modal-content">
                <h2 id="gameOverTitle">Game Over!</h2>
                <p id="gameOverMessage">ƒêi·ªÉm s·ªë c·ªßa b·∫°n: <span id="finalScore">0</span></p>
                <p id="newRecordMessage" style="display: none;">üéâ K·ª∑ l·ª•c m·ªõi!</p>
                <button class="btn btn-primary" id="playAgainBtn">Ch∆°i l·∫°i</button>
            </div>
        </div>

        <div class="pause-modal" id="pauseModal">
            <div class="modal-content">
                <h2>Game ƒë√£ t·∫°m d·ª´ng</h2>
                <button class="btn btn-primary" id="resumeBtn">Ti·∫øp t·ª•c</button>
                <button class="btn btn-secondary" id="mainMenuBtn">Menu ch√≠nh</button>
            </div>
        </div>
    </div>

    <div class="rules-modal" id="rulesModal">
        <div class="modal-content">
            <h2>H∆∞·ªõng d·∫´n ch∆°i</h2>
            <ul>
                <li>Quan s√°t m√†u m·ª•c ti√™u v√† ch·ªçn m√†u gi·ªëng nh·∫•t</li>
                <li>M·ªói c√¢u tr·∫£ l·ªùi ƒë√∫ng ƒë∆∞·ª£c 10 ƒëi·ªÉm</li>
                <li>Combo li√™n ti·∫øp s·∫Ω nh√¢n ƒë√¥i ƒëi·ªÉm s·ªë</li>
                <li>B·∫°n c√≥ 3 m·∫°ng, m·∫•t m·∫°ng khi tr·∫£ l·ªùi sai</li>
                <li>S·ª≠ d·ª•ng g·ª£i √Ω t·ªën 5 ƒëi·ªÉm</li>
                <li>Th·ªùi gian gi·ªõi h·∫°n: 30 gi√¢y m·ªói c√¢u</li>
            </ul>
            <button class="btn btn-primary" id="closeRulesBtn">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // Game state variables
        let score = 0;
        let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
        let level = 1;
        let lives = 3;
        let combo = 0;
        let totalGames = localStorage.getItem('totalGames') ? parseInt(localStorage.getItem('totalGames')) : 0;
        let correctGuesses = localStorage.getItem('correctGuesses') ? parseInt(localStorage.getItem('correctGuesses')) : 0;
        let totalGuesses = localStorage.getItem('totalGuesses') ? parseInt(localStorage.getItem('totalGuesses')) : 0;
        let bestCombo = localStorage.getItem('bestCombo') ? parseInt(localStorage.getItem('bestCombo')) : 0;
        let targetColor = null;
        let timeLeft = 30;
        let timerInterval = null;
        let isPaused = false;

        // DOM elements
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const levelElement = document.getElementById('level');
        const livesElement = document.getElementById('lives');
        const targetColorElement = document.getElementById('targetColor');
        const colorCodeElement = document.getElementById('colorCode');
        const colorOptionsElement = document.getElementById('colorOptions');
        const difficultySelector = document.getElementById('difficulty');
        const timerFillElement = document.getElementById('timerFill');
        const timerTextElement = document.getElementById('timerText');
        const comboCounterElement = document.getElementById('comboCounter');
        const comboValueElement = document.getElementById('comboValue');
        const gameOverModal = document.getElementById('gameOverModal');
        const pauseModal = document.getElementById('pauseModal');
        const rulesModal = document.getElementById('rulesModal');
        const finalScoreElement = document.getElementById('finalScore');
        const newRecordMessage = document.getElementById('newRecordMessage');
        const totalGamesElement = document.getElementById('totalGames');
        const accuracyElement = document.getElementById('accuracy');
        const bestComboElement = document.getElementById('bestCombo');

        // Initialize game
        function initGame() {
            scoreElement.textContent = score;
            highScoreElement.textContent = highScore;
            levelElement.textContent = level;
            livesElement.textContent = '‚ù§Ô∏è'.repeat(lives);
            totalGamesElement.textContent = totalGames;
            accuracyElement.textContent = totalGuesses > 0 ? Math.round((correctGuesses / totalGuesses) * 100) + '%' : '0%';
            bestComboElement.textContent = bestCombo;
            newRound();
        }

        // Start a new round
        function newRound() {
            if (lives <= 0) {
                endGame();
                return;
            }
            timeLeft = 30;
            timerTextElement.textContent = `${timeLeft}s`;
            timerFillElement.style.width = '100%';
            clearInterval(timerInterval);
            startTimer();
            generateColors();
            comboCounterElement.style.display = combo > 1 ? 'block' : 'none';
            if (combo > 1) {
                comboValueElement.textContent = combo;
            }
        }

        // Start the timer
        function startTimer() {
            timerInterval = setInterval(() => {
                if (isPaused) return;
                timeLeft--;
                timerTextElement.textContent = `${timeLeft}s`;
                timerFillElement.style.width = `${(timeLeft / 30) * 100}%`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    lives--;
                    livesElement.textContent = '‚ù§Ô∏è'.repeat(lives);
                    combo = 0;
                    newRound();
                }
            }, 1000);
        }

        // Generate random RGB color
        function generateRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return { r, g, b };
        }

        // Generate colors for the round
        function generateColors() {
            const difficulty = difficultySelector.value;
            const numColors = difficulty === 'easy' ? 3 : difficulty === 'medium' ? 6 : 9;
            colorOptionsElement.className = `color-options ${difficulty}`;
            colorOptionsElement.innerHTML = '';

            targetColor = generateRandomColor();
            targetColorElement.style.backgroundColor = `rgb(${targetColor.r}, ${targetColor.g}, ${targetColor.b})`;
            colorCodeElement.textContent = `RGB(${targetColor.r}, ${targetColor.g}, ${targetColor.b})`;

            const colors = [targetColor];
            while (colors.length < numColors) {
                const newColor = generateRandomColor();
                if (!colors.some(c => c.r === newColor.r && c.g === newColor.g && c.b === newColor.b)) {
                    colors.push(newColor);
                }
            }

            // Shuffle colors
            for (let i = colors.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [colors[i], colors[j]] = [colors[j], colors[i]];
            }

            // Create color option buttons
            colors.forEach(color => {
                const button = document.createElement('div');
                button.classList.add('color-option');
                button.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
                button.addEventListener('click', () => checkAnswer(color));
                colorOptionsElement.appendChild(button);
            });
        }

        // Check the player's answer
        function checkAnswer(selectedColor) {
            totalGuesses++;
            clearInterval(timerInterval);
            const isCorrect = selectedColor.r === targetColor.r && selectedColor.g === targetColor.g && selectedColor.b === targetColor.b;
            const button = event.target;
            button.classList.add(isCorrect ? 'correct' : 'incorrect');

            if (isCorrect) {
                correctGuesses++;
                combo++;
                if (combo > bestCombo) {
                    bestCombo = combo;
                    localStorage.setItem('bestCombo', bestCombo);
                }
                score += 10 * (combo > 1 ? combo : 1);
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('highScore', highScore);
                }
                scoreElement.textContent = score;
                highScoreElement.textContent = highScore;
                level = Math.floor(score / 50) + 1;
                levelElement.textContent = level;
            } else {
                lives--;
                livesElement.textContent = '‚ù§Ô∏è'.repeat(lives);
                combo = 0;
            }

            localStorage.setItem('totalGuesses', totalGuesses);
            localStorage.setItem('correctGuesses', correctGuesses);
            accuracyElement.textContent = totalGuesses > 0 ? Math.round((correctGuesses / totalGuesses) * 100) + '%' : '0%';
            bestComboElement.textContent = bestCombo;

            setTimeout(newRound, 1000);
        }

        // End the game
        function endGame() {
            totalGames++;
            localStorage.setItem('totalGames', totalGames);
            totalGamesElement.textContent = totalGames;
            finalScoreElement.textContent = score;
            if (score > highScore) {
                newRecordMessage.style.display = 'block';
            }
            gameOverModal.style.display = 'flex';
        }

        // Provide a hint
        function giveHint() {
            if (score < 5) return;
            score -= 5;
            scoreElement.textContent = score;
            const options = colorOptionsElement.children;
            for (let option of options) {
                const color = option.style.backgroundColor.match(/\d+/g).map(Number);
                if (color[0] === targetColor.r && color[1] === targetColor.g && color[2] === targetColor.b) {
                    option.classList.add('hint');
                    break;
                }
            }
        }

        // Event listeners
        document.getElementById('newGameBtn').addEventListener('click', () => {
            score = 0;
            lives = 3;
            combo = 0;
            level = 1;
            initGame();
        });

        document.getElementById('hintBtn').addEventListener('click', giveHint);

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = true;
            pauseModal.style.display = 'flex';
        });

        document.getElementById('resumeBtn').addEventListener('click', () => {
            isPaused = false;
            pauseModal.style.display = 'none';
            startTimer();
        });

        document.getElementById('mainMenuBtn').addEventListener('click', () => {
            pauseModal.style.display = 'none';
            clearInterval(timerInterval);
            score = 0;
            lives = 3;
            combo = 0;
            level = 1;
            initGame();
        });

        document.getElementById('playAgainBtn').addEventListener('click', () => {
            gameOverModal.style.display = 'none';
            score = 0;
            lives = 3;
            combo = 0;
            level = 1;
            initGame();
        });

        document.getElementById('rulesBtn').addEventListener('click', () => {
            rulesModal.style.display = 'flex';
        });

        document.getElementById('closeRulesBtn').addEventListener('click', () => {
            rulesModal.style.display = 'none';
        });

        document.getElementById('statsBtn').addEventListener('click', () => {
            document.getElementById('statsPanel').style.display = 'block';
        });

        document.getElementById('resetStatsBtn').addEventListener('click', () => {
            totalGames = 0;
            correctGuesses = 0;
            totalGuesses = 0;
            bestCombo = 0;
            localStorage.setItem('totalGames', totalGames);
            localStorage.setItem('correctGuesses', correctGuesses);
            localStorage.setItem('totalGuesses', totalGuesses);
            localStorage.setItem('bestCombo', bestCombo);
            totalGamesElement.textContent = totalGames;
            accuracyElement.textContent = '0%';
            bestComboElement.textContent = bestCombo;
        });

        difficultySelector.addEventListener('change', newRound);

        // Start the game
        initGame();
    </script>
</body>
</html>